- name: Proxmox VE 8 to 9 Upgrade
  tags: proxmox_upgrade
  block:
    # Pre-upgrade checks
    - name: Run pre-upgrade checks
      include_tasks: pre_checks.yml
      tags: [pre_checks, always]

    # VM/CT migration (manual step reminder)
    - name: Display VM migration reminder
      debug:
        msg: |
          IMPORTANTE: Prima di continuare assicurati di aver migrato
          tutte le VM/CT critiche da questo nodo!
      tags: vm_migration

    # Update current system
    - name: Update current Proxmox VE 8 system
      include_tasks: update_current.yml
      tags: update_current

    # Repository configuration
    - name: Configure repositories for Proxmox VE 9
      include_tasks: configure_repos.yml
      tags: configure_repos

    # System upgrade
    - name: Perform system upgrade
      include_tasks: upgrade_system.yml
      tags: upgrade_system

    # Post-upgrade tasks
    - name: Post-upgrade tasks
      include_tasks: post_upgrade.yml
      tags: post_upgrade
