db:
  postgres:
    admin_user: "{{ lookup('community.hashi_vault.hashi_vault', 'ansible/data/postgres:admin_user') }}"
    admin_password: "{{ lookup('community.hashi_vault.hashi_vault', 'ansible/data/postgres:admin_password') }}"
    pgadmin_email: "{{ lookup('community.hashi_vault.hashi_vault', 'ansible/data/postgres:pgadmin_email') }}"
    pgadmin_password: "{{ lookup('community.hashi_vault.hashi_vault', 'ansible/data/postgres:pgadmin_password') }}"

    databases:
      - name: invidious_db
        owner: invidious_user
        encoding: UTF8
        lc_collate: en_US.UTF-8
        lc_ctype: en_US.UTF-8
        extensions:
          - pg_trgm
          - btree_gin
      
      - name: authentik_db
        owner: authentik_user
        encoding: UTF8
        lc_collate: en_US.UTF-8
        lc_ctype: en_US.UTF-8
      
      - name: matrix_db
        owner: matrix_user
        encoding: UTF8
        lc_collate: C
        lc_ctype: C

      - name: sonarqube_db
        owner: sonarqube_user
        encoding: UTF8
        lc_collate: en_US.UTF-8
        lc_ctype: en_US.UTF-8

      - name: kestra_db
        owner: kestra_user
        encoding: UTF8
        lc_collate: en_US.UTF-8
        lc_ctype: en_US.UTF-8

    users:
      # Utenti applicativi con accesso completo al loro database
      - name: invidious_user
        password: "{{ lookup('community.hashi_vault.hashi_vault', 'ansible/data/invidious:postgres_password') }}"
        databases:
          - invidious_db
        privileges: ALL
        table_privs: ALL
        sequence_privs: ALL
      
      - name: authentik_user
        password: "{{ lookup('community.hashi_vault.hashi_vault', 'cross/data/apps/authentik:postgres_password') }}"
        databases:
          - authentik_db
        privileges: ALL
        table_privs: ALL
        sequence_privs: ALL

      - name: matrix_user
        password: "{{ lookup('community.hashi_vault.hashi_vault', 'cross/data/apps/matrix:postgres_password') }}"
        databases:
          - matrix_db
        privileges: ALL
        table_privs: ALL
        sequence_privs: ALL
      
      - name: sonarqube_user
        password: "{{ lookup('community.hashi_vault.hashi_vault', 'cross/data/apps/sonarqube:postgres_password') }}"
        databases:
          - sonarqube_db
        privileges: ALL
        table_privs: ALL
        sequence_privs: ALL

      - name: kestra_user
        password: "{{ lookup('community.hashi_vault.hashi_vault', 'cross/data/apps/kestra:postgres_password') }}"
        databases:
          - kestra_db
        privileges: ALL
        table_privs: ALL
        sequence_privs: ALL

