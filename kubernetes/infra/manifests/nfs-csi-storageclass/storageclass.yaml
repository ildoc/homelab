---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-csi
  annotations:
    # Inizialmente NON Ã¨ default - decommentare dopo i test
    storageclass.kubernetes.io/is-default-class: "true"
    description: "NFS CSI StorageClass"
provisioner: nfs.csi.k8s.io
parameters:
  server: "192.168.0.123"
  share: "/mnt/data/nfs_shared/k8s"
  # Pattern per organizzare meglio i volumi
  # Crea struttura: /mnt/data/nfs_shared/k8s/namespace/pvc-name/pv-name
  subDir: "${pvc.metadata.namespace}/${pv.metadata.name}"
  
  # Opzionale: mount permissions per nuove directory
  # mountPermissions: "0777"
  
reclaimPolicy: Retain  # Mantieni i dati dopo eliminazione PVC
volumeBindingMode: Immediate
allowVolumeExpansion: true  # Permetti resize dei volumi

# Mount options compatibili con TrueNAS
mountOptions:
  - nfsvers=4.1      # NFSv4.1 
  - hard             # Retry indefinitamente in caso di errore
  - noatime          # Non aggiornare access time (migliori performance)
  # Rimuovi temporaneamente le opzioni problematiche per il debug
