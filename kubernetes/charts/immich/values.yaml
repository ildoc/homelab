immich:
  # Configurazione condivisa tra tutti i componenti Immich
  controllers:
    main:
      containers:
        main:
          image:
            tag: "v2.4.1"
          env:
            # Configurazione database PostgreSQL esterno
            DB_HOSTNAME: "192.168.0.30"
            DB_PORT: "5432"
            DB_DATABASE_NAME: "immich_db"
            DB_USERNAME: "immich_user"
            # La password viene iniettata tramite ExternalSecret
            DB_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: immich-db-secret
                  key: DB_PASSWORD

  immich:
    persistence:
      library:
        existingClaim: "immich-library-pvc"

  # Componenti Immich
  server:
    enabled: true
    ingress:
      main:
        enabled: false

  # Abilita Valkey (Redis) incluso nel chart - necessario per Immich
  valkey:
    enabled: true
    
  # Machine Learning component
  machine-learning:
    enabled: true
    persistence:
      library:
        enabled: true
        type: persistentVolumeClaim
        existingClaim: immich-library-pvc
        globalMounts:
          - path: /data
      

# Configurazione HTTPRoute (template del wrapper)
httproute:
  hostname: "immich.local.ildoc.it"
  serviceName: ""

nfsVolumes:
  - name: library
    pvc: "immich-library-pvc"
    server: "192.168.0.123"
    path: "/mnt/data/nfs_shared/immich"

