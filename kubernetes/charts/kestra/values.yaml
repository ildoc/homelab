kestra:
  # Deploy standalone per homelab
  deployments:
    standalone:
      enabled: true
      replicaCount: 1
      
      resources:
        limits:
          cpu: 2000m
          memory: 4Gi
        requests:
          cpu: 500m
          memory: 2Gi
      
      strategy:
        type: Recreate
    
    # Disabilita deployment separati
    webserver:
      enabled: false
    executor:
      enabled: false
    indexer:
      enabled: false
    scheduler:
      enabled: false
    worker:
      enabled: false

  # Configurazione comune
  common:
    extraEnv:
      - name: TZ
        value: "Europe/Rome"
    
    # Carica secrets per i workflow (accessibili con secret() function)
    extraSecretEnvFrom:
      - name: kestra-secrets
        prefix: SECRET_

  configurations:
    kestra:
      server:
        base-url: "https://kestra.local.ildoc.it"
      
      repository:
        type: postgres
      
      queue:
        type: postgres
      
      storage:
        type: local
        local:
          base-path: "/app/storage"

  # Carica database credentials da External Secret
  externalSecret:
    secretName: kestra-db-secret
    key: application-secrets.yml

  # Service Account
  serviceAccount:
    create: true
    automountToken: false

  # Persistence per storage locale
  persistence:
    enabled: true
    storageClassName: "nfs-csi"
    accessModes:
      - ReadWriteOnce
    size: 20Gi

  # Docker-in-Docker
  dind:
    enabled: true
    
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 100m
        memory: 512Mi

  # Disabilita servizi non necessari
  kafka:
    enabled: false
  
  elasticsearch:
    enabled: false
  
  operator:
    enabled: false

  ingress:
    enabled: false
